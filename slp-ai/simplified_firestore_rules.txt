// PATIENTS COLLECTION - SIMPLIFIED VERSION
match /patients/{patientId} {
  // Allow providers to read any patient records
  // This is less restrictive but simplifies patient lookups by name
  function isProviderSimple() {
    return isAuthenticated() && isProvider();
  }
  
  // Allow read access to providers (for now - can be restricted later)
  allow read: if isProviderSimple() || isAdmin() || isCurrentUser(patientId);
  
  // Only providers and admins can create patient records
  allow create: if (isProvider() || isAdmin()) && 
                request.resource.data.keys().hasAll(['createdAt', 'providerUID']) &&
                request.resource.data.createdAt is timestamp &&
                request.resource.data.providerUID is list &&
                request.auth.uid in request.resource.data.providerUID;
  
  // Allow updates with proper validation
  allow update: if (isProviderSimple() || isAdmin() || isCurrentUser(patientId)) &&
                request.resource.data.updatedAt is timestamp;
  
  // Disallow manual deletion - use soft deletion instead
  allow delete: if false;
} 